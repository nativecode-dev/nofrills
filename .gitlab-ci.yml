image: node:latest

stages:
- test
- publish

before_script:
- source .ci-env
- git submodule sync --init --recursive
- git submodule update --init --recursive
- npm install -g @nofrills/tasks@7.1.7
- cli-tasks ci:install

cache:
  paths:
  - node_modules

feature:
  stage: test
  only:
  - /feature\/.*/
  script:
  - cli-tasks ci:test

fixes:
  stage: publish
  only:
  - /fix\/.*/
  script:
  - cli-tasks ci:publish:canary

prerelease:
  stage: publish
  only:
  - develop
  script:
  - cli-tasks ci:publish:prerelease

release:
  stage: publish
  only:
  - master
  script:
  - cli-tasks ci:publish:release
